rules:
  # ============================================================================
  # LLM06: Sensitive Information Disclosure (OpenAI Generic)
  # ============================================================================
  # Detects secrets/PII in prompts and unsanitized logging
  # OWASP: LLM06
  # CWE: CWE-200, CWE-312, CWE-359
  # ============================================================================

  - id: openai-sensitive-info-in-logging
    patterns:
      - pattern-either:
          - pattern: |
              $RESPONSE = openai.ChatCompletion.create(...)
          - pattern: |
              $RESPONSE = openai.Completion.create(...)
          - pattern: |
              $RESPONSE = $CLIENT.chat.completions.create(...)
      - pattern-inside: |
          $CONTENT = $RESPONSE.choices[0].message.content
          ...
      - pattern-either:
          # print statements
          - pattern: print($CONTENT)
          - pattern: print(f"...{$CONTENT}...")
          # logging module - all levels
          - pattern: logging.debug($CONTENT)
          - pattern: logging.info($CONTENT)
          - pattern: logging.warning($CONTENT)
          - pattern: logging.error($CONTENT)
          - pattern: logging.critical($CONTENT)
          - pattern: logging.log(..., $CONTENT)
          - pattern: logging.debug(f"...{$CONTENT}...")
          - pattern: logging.info(f"...{$CONTENT}...")
          - pattern: logging.warning(f"...{$CONTENT}...")
          - pattern: logging.error(f"...{$CONTENT}...")
          - pattern: logging.critical(f"...{$CONTENT}...")
          # logger object - all levels
          - pattern: logger.debug($CONTENT)
          - pattern: logger.info($CONTENT)
          - pattern: logger.warning($CONTENT)
          - pattern: logger.error($CONTENT)
          - pattern: logger.critical($CONTENT)
          - pattern: logger.exception($CONTENT)
          - pattern: logger.log(..., $CONTENT)
          - pattern: logger.debug(f"...{$CONTENT}...")
          - pattern: logger.info(f"...{$CONTENT}...")
          - pattern: logger.warning(f"...{$CONTENT}...")
          - pattern: logger.error(f"...{$CONTENT}...")
          - pattern: logger.critical(f"...{$CONTENT}...")
          # sys.stdout/stderr
          - pattern: sys.stdout.write($CONTENT)
          - pattern: sys.stderr.write($CONTENT)
          - pattern: sys.stdout.writelines([$CONTENT])
          - pattern: sys.stderr.writelines([$CONTENT])
    message: "LLM06: Sensitive Information Disclosure - OpenAI response logged without sanitization"
    severity: WARNING
    languages: [python]
    metadata:
      category: security
      subcategory: information-disclosure
      owasp: "LLM06"
      owasp-title: "Sensitive Information Disclosure"
      owasp-url: "https://owasp.org/www-project-top-10-for-large-language-model-applications/LLM_Top_10/LLM06.html"
      cwe: ["CWE-200", "CWE-312", "CWE-359"]
      cwe-url: ["https://cwe.mitre.org/data/definitions/200.html", "https://cwe.mitre.org/data/definitions/312.html", "https://cwe.mitre.org/data/definitions/359.html"]
      tags: ["owasp", "llm06", "sensitive-info", "logging", "pii", "llm", "ai-security", "data-leakage", "openai"]
      technology: ["python", "openai", "llm"]
      confidence: "high"
      impact: "medium"
      likelihood: "high"
      description: "OpenAI responses are logged or printed without sanitization, potentially exposing sensitive information that the LLM may have included in its output. Detects multiple logging methods (debug, info, warning, error, critical), print statements, and sys.stdout/stderr writes."
      remediation: "Sanitize LLM responses before logging. Remove or redact sensitive information. Use structured logging with data classification."
      examples:
        vulnerable: "samples/llm06_sensitive_info.py"
      references:
        - "https://owasp.org/www-project-top-10-for-large-language-model-applications/"
        - "https://owasp.org/www-community/vulnerabilities/Information_exposure"
    paths:
      include:
        - "*.py"
