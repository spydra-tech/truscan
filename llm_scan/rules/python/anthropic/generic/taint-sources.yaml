rules:
  - id: llm-taint-anthropic
    patterns:
      - pattern: $CLIENT.messages.create(...)
      - pattern-inside: |
          $RESPONSE = ...
          $CONTENT = $RESPONSE.content[0].text
          ...
          $SINK($CONTENT)
    message: "Anthropic API response content flows to dangerous sink"
    severity: WARNING
    languages: [python]
    metadata:
      category: security
      subcategory: taint-analysis
      cwe: ["CWE-94"]
      cwe-url: ["https://cwe.mitre.org/data/definitions/94.html"]
      tags: ["taint-source", "anthropic", "llm", "ai-security", "data-flow"]
      technology: ["python", "anthropic", "llm"]
      confidence: "high"
      impact: "medium"
      likelihood: "medium"
      description: "Anthropic API (client.messages.create) response content flows to a potentially dangerous sink function, indicating a taint flow vulnerability."
      remediation: "Validate and sanitize LLM output before using in dangerous operations. Implement proper input validation and output sanitization."
      examples:
        vulnerable: "samples/vulnerable_app.py"
      references:
        - "https://owasp.org/www-community/vulnerabilities/Code_Injection"
        - "https://cwe.mitre.org/data/definitions/94.html"
    paths:
      include:
        - "*.py"
